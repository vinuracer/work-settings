"use strict";var joinmeeting=function(){var f,v,p,k,h,b,C,S,T,w,y,L,M,I=!1,o=!1;var e=void 0;function n(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],o=$("#btn-sso-continue");e?(o.addClass("isLoading").removeClass("enabled"),a(!1)):(a(),o.removeClass("isLoading").addClass("enabled"))}function i(){n(!1);var e=$("#login-webview")[0];$("#login-webview-wrapper").fadeIn(10,function(){$("#login-webview-wrapper").removeClass("screen-right hideMe")}),e.src="about:blank",$("#btn-back-zoom").one("click",function(e){O()})}function t(){var o;$(".tab3 .container-login").addClass("screen-left"),$("#container-sso").removeClass("screen-right"),o=$("#btn-sso-continue"),$("#btn-sso-back").one("click",function(){$(".tab3 .container-login").removeClass("screen-left"),$("#container-sso").addClass("screen-right")}),$("#login-sso-domain").unbind("input keyup").bind("input",function(e){0<$(this).val().length&&!o.hasClass("enable")?a():o.removeClass("enabled").unbind("click")}).bind("keyup",function(e){return"Enter"===e.key?o.click():""}),$("#login-sso-domain,#login-sso-email").unbind("input keyup").bind("input",function(e){0<$(this).val().length&&!o.hasClass("enabled")?(a(),o.addClass("enabled")):0===$(this).val().length&&o.hasClass("enabled")&&o.removeClass("enabled").unbind("click")}).bind("keyup",function(e){return"Enter"===e.key?o.click():""}),$("#btn-unknow-domain").unbind("click").click(function(e){$("#container-know-domain").hide().addClass("hideMe"),$("#container-unknow-domain").fadeIn(200).removeClass("hideMe"),0<$("#login-sso-email").val().length?(a(),o.addClass("enabled")):o.removeClass("enabled").unbind("click")}),$("#btn-know-domain").unbind("click").click(function(e){$("#container-unknow-domain").hide().addClass("hideMe"),$("#container-know-domain").fadeIn(200).removeClass("hideMe"),0<$("#login-sso-domain").val().length?(a(),o.addClass("enabled")):o.removeClass("enabled").unbind("click")})}function a(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],o=$("#btn-sso-continue");e?o.unbind("click").click(function(e){$("#login-sso-domain").is(":visible")?0<$("#login-sso-domain").val().length&&q($("#login-sso-domain").val()+".zoom.us"):$("#login-sso-email").val().length&&(Q($("#login-sso-email").val()),n())}):o.unbind("click")}var s=void 0;function r(){var e,o=$("#login-email").val(),n=$("#login-pwd").val();return""!==o&&""!==n&&$("#login-submit").hasClass("enabled")?!!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(o)||(e=te("login-email"),$("#login-email").one("focus",function(){$("#login-email").removeClass("focus"),clearInterval(e)}),!1):(""===o?e=te("login-email"):""===n&&(e=te("login-pwd")),$("#login-email,#login-password").one("focus",function(){$("#login-email,#login-password").removeClass("focus"),clearInterval(e)}),!1)}var l=void 0;function c(){d(),l=registerTimer(3e4,function(){console.error("Login time out."),E({errorStr:"Login time out."})})}function d(){clearTimeout(l)}function u(){W=0,m(!1);var e=$("#login-email").val();saveToLocal("userEmail",e),P(e,$("#login-pwd").val(),$("#keep-login-option").next().hasClass("selected")),$("#login-form").addClass("forceHide"),$(".login-loading-container").removeClass("hideMe"),accessibility.focusWithoutOutline(".login-loading-container .login-text"),$(".login-loading").removeClass("hideMe")}function m(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],o=$(".container-other-login,.divider");e?o.show():o.hide()}var W=0;function N(e){var o=setInterval(function(){if(null!==common.naclModule&&(window.clearInterval(o),!backgroundWindow.getIsWeblaunched()&&void 0!==localStorage.userToken)){if(!e&&!localStorage.keepLogin)return void removeFromLocal("userToken");!function(){W=1;var e=localStorage.userToken.type,o=localStorage.userToken.token,n=localStorage.userToken.refreshToken,i=localStorage.userToken.expireIn,t=localStorage.userToken.createTimeSince1970inSec,a=localStorage.userToken.isSelectedRoomLogin,s=localStorage.userToken.roomEmail;0===e&&_(o,"","")||2===e&&V(o,n,i,t)||100===e&&!a&&z(o)||100===e&&a&&F(o,s)||101===e&&Y(o)}(),c(),m(!1),g.getLoginState()||R()}},400);common.registTimer(o)}function R(){$("#login-form").addClass("forceHide"),$(".login-loading-container").removeClass("hideMe"),$("#join-panel li.tab3").click(),$("#login-submit").removeClass("enabled"),$("#login-submit .text-label").text("auto signing.."),$(".login-loading").removeClass("hideMe")}function O(){$("#login-webview-wrapper").addClass("screen-right").fadeOut(200),$("#login-webview").length&&$("#login-webview")[0]&&($("#login-webview")[0].src="about:blank")}function j(e){saveToLocal("keepLogin",e)}var A=void 0;var x=0;function E(e){if(userStatus={},d(),m(),O(),$(".container-login").removeClass("screen-left"),$(".login-loading-container").addClass("hideMe"),backgroundWindow.isKioskApp()&&kiosk.isLoginWithActivationCode())kiosk.onActivateResult(0,e);else{var o=10006e4===e.result?g.getConstants()[10006e4]:e.errorStr;$(".login-error-msg").text(o).removeClass("hideMe"),accessibility.focusWithoutOutline(".login-error-msg"),clearTimeout(A),A=registerTimer(5e3,function(){$(".login-error-msg").addClass("hideMe")})}g.setLoginState(!1),uiAgent.showSignedOutUI(),$("#login-email").val(localStorage.userEmail);var n=$("#login-pwd");""===n.val()&&n.val("**********"),ee()}var U=void 0;function B(){x=0,clearTimeout(U)}function P(e,o,n){c(),common.postMessageToNaCl({type:"user",command:"user.login",name:e,password:o,keepLogin:n})}function z(e){c(),common.postMessageToNaCl({type:"user",command:"user.loginWithToken",token:e})}function F(e,o){common.postMessageToNaCl({type:"user",command:"user.loginZRroomWithToken",token:e,roomEmail:o})}var D=void 0;function Z(){clearTimeout(D)}function H(){Z(),D=setTimeout(uiAgent.startOrJoinMeetingTimeOut,9e4)}function J(o){getFromLocal("userToken",function(e){W=0,localStorage.userToken=e,$("#login-webview")[0].src=localStorage.userToken.logoutUrl,$("#login-form").removeClass("forceHide"),$(".index-up .loading-container,.index-up .login-loading").removeClass("hideMe"),removeFromLocal("userToken","keepLogin"),uiAgent.onLogouting(),userStatus={},saveToLocal("usePMIOption",!1),g.setLoginState(!1),common.postMessageToNaCl({type:"user",command:"user.logout"}),"function"==typeof o&&o()})}function G(){common.postMessageToNaCl({type:"user",command:"user.getGoogleLoginURL"})}function V(e,o,n,i){c(),common.postMessageToNaCl({type:"user",command:"user.loginWithGoogleWithOAuth",token:e,refreshToken:o,expireIn:n,createTimeSince1970inSec:i})}function K(){common.postMessageToNaCl({type:"user",command:"user.getFBLoginURL"})}function _(e,o,n){c(),common.postMessageToNaCl({type:"user",command:"user.loginWithFacebook",accessToken:e,expire:o,url:n})}function q(e){common.postMessageToNaCl({type:"user",command:"user.getSSOLoginURL",domain:e})}function Q(e){common.postMessageToNaCl({type:"user",command:"user.querySSOVanityURLByEmail",email:e})}function Y(e){c(),common.postMessageToNaCl({type:"user",command:"user.loginWithSSOToken",token:e})}var X=!0;function ee(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]?$("#login-submit").removeClass("enabled").attr("aria-disabled","false").off("click"):$("#login-submit").addClass("enabled").attr("aria-disabled","true").off("click").click(function(e){e.preventDefault(),e.stopPropagation(),localStorage.userToken&&X?N(1):r()&&u()})}function oe(e){e?$("#btnSubmit").addClass("enabled").attr("aria-disabled","false"):$("#btnSubmit").removeClass("enabled").attr("aria-disabled","true")}function ne(n,i){n=n||util.trim($("#join-confno").val());ae(i=i||$("#join-username").val()),uiAgent.showConnecting("join");var t=$("#connectOption").is(":checked"),o=setInterval(function(){if(null!==common.naclModule)if(clearInterval(o),I)I=!1,getFromLocal("lcpString",function(e){if(e){var o=void 0!==localStorage.userToken&&1===localStorage.userToken.isSelectedRoomLogin?1:0;common.postMessageToNaCl({type:"user",command:"user.rejoinConf",confNo:backgroundWindow.getMeetingID(),userName:backgroundWindow.getMeetingScreenName(),lcpString:e,registerEmail:backgroundWindow.getRegisterEmail(),registerName:backgroundWindow.getRegisterName(),isZRRoomLoginBefore:o})}else common.postMessageToNaCl({type:"user",command:"user.joinConf",confNo:n,userName:i,password:v,loginType:k,loginToken:h,uid:b,domain:C,wtk:S,trackID:T,email:w,zak:y,zakt:L,pk:M.pk||"",notConnectAudio:t})});else{common.postMessageToNaCl({type:"user",command:"user.joinConf",confNo:n,userName:i,password:v,loginType:k,loginToken:h,uid:b,domain:C,wtk:S,trackID:T,email:w,zak:y,zakt:L,pk:M.pk||"",notConnectAudio:t});var e={};e.meetingID=n,e.meetingScreenName=i,backgroundWindow.setRejoinParams(e)}},500)}function ie(){var e,o=util.trim($("#join-confno").val()),n=$("#join-username").val();return!(""===o||""===n||!$("#btnSubmit").hasClass("enabled"))||(""===o?e=te("join-confno"):""===n&&(e=te("join-username")),$("#join-confno,#join-username").one("focus",function(){$("#join-confno,#join-username").removeClass("focus"),clearInterval(e)}),!1)}function te(e){var o=0,n=setInterval(function(){if(6<=++o)return clearInterval(n),$("#"+e).removeClass("focus"),void $("#"+e).focus();o%2==1&&$("#"+e).addClass("focus"),o%2==0&&$("#"+e).removeClass("focus")},500);return n}function ae(e){e&&saveToLocal("screenName",e,function(){$("#screenName").val(e)})}var se=0,re=void 0;function le(){chrome.storage.local.clear(function(e){chrome.runtime.lastError?ce(0):(localStorage={},ce(1))})}function ce(e){e?$("#dev-tools .alert-storage").removeClass("forceHide alert-danger").addClass("alert-success").find("p").text("Clear Success."):$("#dev-tools .alert-storage").removeClass("forceHide alert-success").addClass("alert-danger").find("p").text("Clear failed.")}function ue(){$(".version span").text(appObject.version),$("#domainInfo").text(backgroundWindow.getWebDomain()),$("#dev-tools .alert-storage").addClass("forceHide"),g.getLoginState()?$("#dev-tools .dropdown-menu, #dev-tools .caret").addClass("forceHide"):$("#dev-tools .dropdown-menu, #dev-tools .caret").removeClass("forceHide"),$("#dev-tools").modal({backdrop:!1,show:!0})}function de(e,o){common.postMessageToNaCl({type:"conf",command:"conf.confirmPrivacyAndTOS",agree:e,resource:o})}return{setInMeeting:function(e){o=e},ifInMeeting:function(){return o},bindForm:function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;setMainAppWindowObject(mainWindow),uiAgent.appUIInit(),videoConstraints={video:!0},chrome.storage.local.get(null,function(e){chrome.runtime.lastError||(localStorage=e),client.showConfnoArrowAndScreenName(),client.joinFromUrl(),o&&N()}),a11y(),$("#zoom-logo, #dev-tools .about-logo").unbind("click").click(function(e){4===se&&($(this).hasClass("zoom-logo")?ue():$("#dev-tools .modal-footer").removeClass("forceHide"),se=0),se++,clearTimeout(re),re=setTimeout(function(){se=0},500)}),$(".setting-window .icon-container").off("click").on("click",function(e){winMgr.createWindow("settingWindow","build/window/settingWindow.html",{width:680,height:600})}),$("#dev-tools .change-domain-group").undelegate("[data-domain]","click").delegate("[data-domain]","click",function(e){g.getLoginState()||(backgroundWindow.setWebDomain($(e.currentTarget).attr("data-domain")),$("#dev-tools").modal("hide"))}),$("#dev-tools .btn-clear-storage").unbind("click").click(function(){userStatus.isZRLogin?kiosk.verifyLockCode(userStatus.zrLockCode,"logout").then(le):0===userStatus.isZRLogin?J(le):le()}),$("#dev-tools .btn-clear-persistent").unbind("click").click(function(){weblog.stopWriter(),fsObj.clearAll(function(e){ce(!e)})}),$(".dev").unbind("dblclick").dblclick(function(){ue()}),$("#dev-tools").unbind("click").click(function(e){"dev-tools"===$(e.target).attr("id")&&$(this).modal("hide")}),$(".tab3 .container-other-login").undelegate("[id^=btn]","click").delegate("[id^=btn]","click",function(e){switch($(this).attr("id")){case"btn-login-google":G(),i();break;case"btn-login-sso":t();break;case"btn-login-facebook":K(),i();break;case"btn-activation":kiosk.showActivationPage(1)}})},saveConfList:function(e){var o,n=common.addSpace(e.meetingno),i={meetingno:n,meetingtopic:e.meetingtopic};if(void 0!==localStorage.confList){o=localStorage.confList;for(var t=0;t<o.length;t++)if(o[t].meetingno==n){o.splice(t,1);break}}else o=[];for(o.unshift(i);10<o.length;)o.pop();saveToLocal("confList",o)},verifyJoinPassword:function(e){common.postMessageToNaCl({type:"conf",command:"conf.setPassword",password:e});var o={};o.meetingPassword=e,backgroundWindow.setRejoinParams(o)},joinBtnBindEventListener:function(){$("#btnSubmit").off("click").click(function(){ie()&&ne()}),$("#join-confno, #join-username").unbind("keydown").keydown(function(e){"13"==e.keyCode&&ie()&&ne()}),$("#login-form input[type=password],#login-form input[type=email]").unbind("keydown").keydown(function(e){"13"==e.keyCode&&r()&&u()}).unbind("input propertychange").bind("input propertychange",function(){X=!1,0<util.trim($("#login-email").val()).length&&0<util.trim($("#login-pwd").val()).length?ee():ee(!1)}),ee(!1)},setJoinParameters:function(e,o,n,i,t,a,s,r,l,c,u,d,g,m){f=e,v=o,p=n,k=i,h=t,b=a,C=s,S=r,T=l,w=c,y=u,L=d,I=m,M=g},formSubmit:ne,formCheck:ie,validateJoinInputAndEnableSubmit:function(){var e=util.trim($("#join-username").val());o=util.trim($("#join-confno").val()),(/^[0-9]*$/.test(o)?8<o.length:4<o.length)&&1<=e.length?oe(!0):oe(!1);var o},login:P,loginZRroom:function(e,o,n){c(),common.postMessageToNaCl({type:"user",command:"user.loginZRroom",name:e,password:o,roomEmail:n})},loginWithToken:z,loginZRroomWithToken:F,startInstantMeeting:function(e,o){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;H(),common.postMessageToNaCl({type:"user",command:"user.startConf",withVideo:e,alwaysUsePMI:o,audioOnly:n,duration:30})},logout:J,getGoogleLoginURL:G,loginGoogleWithTokens:function(e){common.postMessageToNaCl({type:"user",command:"user.loginGoogleWithTokens",url:e})},loginWithGoogleWithOAuth:V,getFBLoginURL:K,loginWithFacebook:_,getSSOLoginURL:q,querySSOVanityURLByEmail:Q,loginWithSSOToken:Y,loginSuccess:function(e){B(),d(),O(),m(),g.setLoginState(!0),$(".index-up .loading-container").removeClass("hideMe"),userStatus=Object.assign({},e),delete userStatus.EVENT,delete userStatus.TYPE;var s=userStatus.zoomToken;100!==userStatus.snsType&&(j(!0),s=userStatus["3rdLoginToken"]);var r=void 0,l=void 0,c=void 0,u="";0===userStatus.snsType?(u="https://www.facebook.com/logout.php?access_token=",u+=userStatus["3rdLoginToken"],u+="&next=http%3A%2F%2Fwww.zoom.us"):2===userStatus.snsType?(u="https://www.google.com/accounts/Logout",userStatus.refreshToken&&(r=userStatus.refreshToken),userStatus.expireIn&&(l=userStatus.expireIn),userStatus.createTimeSince1970inSec&&(c=userStatus.createTimeSince1970inSec)):101===userStatus.snsType&&(u=e.SSOLogoutUrl),getFromLocal("userToken",function(e){var o,n,i,t,a;2!==userStatus.snsType||r&&l&&c||(r=e.refreshToken,l=e.expireIn,c=e.createTimeSince1970inSec),o=s,n=u,i=r,t=l,a=c,saveToLocal("userToken",{type:userStatus.snsType,token:o,logoutUrl:n,refreshToken:i,expireIn:t,createTimeSince1970inSec:a,isSelectedRoomLogin:userStatus.isSelectedRoomLogin,roomEmail:userStatus.isSelectedRoomLogin?userStatus.email:""})}),uiAgent.showSignedInUI()},loginFailed:E,show3rdLogin:m,hideWebview:O,refreshLoginLoadingUI:R,getBuddyList:function(){common.postMessageToNaCl({type:"user",command:"user.getBuddyList"})},getRoomList:function(){common.postMessageToNaCl({type:"user",command:"user.getRoomList"})},searchBuddyByKey:function(e){common.postMessageToNaCl({type:"user",command:"user.searchBuddyByKey",key:e})},inviteBuddyToConf:function(e){common.postMessageToNaCl({type:"user",command:"user.inviteBuddyToConf",JIDArray:e})},renderSSO:t,renderWebview:i,clearStartJoinTimmer:Z,startJoinTimmer:H,showSsoDomainQueryFailedMsg:function(){$(".sso-domain-errmsg").removeClass("hideMe"),n(!1),clearTimeout(s),s=registerTimer(5e3,function(){$(".sso-domain-errmsg").addClass("hideMe")})},startCheckWindowHeartBeat:function(){clearInterval(e),e=setInterval(function(){backgroundWindow.setMainWindowExist()},1e3)},hideWaiting:function(){$(".waiting_container").addClass("hideMe")},saveScreenName:ae,showGDPR:function(e){d();var o=e.tosURL,n=e.privacyURL,i=e.resource,t=$("#modal-gdpr");t.find(".case").addClass("hideMe"),o&&n&&($("#modal-gdpr .gdpr-ts").attr("href",o),$("#modal-gdpr .gdpr-pp").attr("href",n));var a,s,r=1;"conf"===i&&(r=2),t.find(".case"+r).removeClass("hideMe"),1===r?$("#modal-gdpr .modal-dialog").css("width","560px"):$("#modal-gdpr .modal-dialog").css("width","480px"),a=i,(s=$("#modal-gdpr")).undelegate().delegate("button","click",function(e){$(this).hasClass("agree")?(s.modal("hide"),"conf"===a&&($(".waiting_container").addClass("hideMe"),uiAgent.showConnecting()),de(1,a)):$(this).hasClass("disagree")?(s.find(".case").addClass("hideMe"),s.find(".case3").removeClass("hideMe")):$(this).hasClass("leave-meeting")&&(s.modal("hide"),de(0,a))}),t.modal("show")},getLoginRetryFlag:function(){return x},loginMaintain:N,isLoginWithToken:function(){return W},hideLoginErrorMsg:function(){$(".login-error-msg").addClass("hideMe"),clearTimeout(A)},signInStateCheck:function(){return g.getLoginState()},loginSubmit:u,setKeepLogin:j,setVideoOption:function(){var e=$("#videoOption").is(":checked");meetingAutoStartMyVideo=!e},setLoginOption:function(){j(!!$("#keep-login-option").next().hasClass("selected"))},setPMIOption:function(){var e=$("#use-pmi-option").is(":checked");saveToLocal("usePMIOption",e)},enableLoginSubmitBtn:ee,cancelRetryLogin:B,lazyStartCallOut:function(e,o,n){common.postMessageToNaCl({type:"conf",command:"conf.lazyStartCallOut",countryCode:e,callOutNumber:o,callOutName:n||""})},getJoinParameters:function(){return{paraMeetingID:f,paraMeetingPassword:v,paraMeetingScreenName:p,paraMeetingLoginType:k,paraMeetingLoginToken:h,paraMeetingUid:b,paraDomain:C,paraWebinarToken:S,paraTrackId:T,paraEmail:w,paraZak:y,paraZakt:L,paramWebLaunchUrlScheme:M,paraIsRejoin:I}},clearLoginSubmitTimer:d}}();